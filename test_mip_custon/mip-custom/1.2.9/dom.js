define("mip-custom/dom",["require","util","templates","fixed-element","mip-custom/log","mip-custom/data"],function(t){function e(t,e){return parseInt(u.css(t,e),10)||0}function i(t,e,i){var n=e.getAttribute("mip-fixed"),o=e.getAttribute("top")||null,r=e.getAttribute("bottom")||null,a=document.createElement("mip-fixed");if(u.platform.isIos())i.remove(),x=10;if(e.hasAttribute("top")&&o)u.css(a,{top:o});if(e.hasAttribute("bottom")&&r)u.css(a,{bottom:r});if(a.setAttribute("type",n),a.appendChild(e),t.appendChild(a),"bottom"===n)a.classList.add("mip-custom-transit-from-bottom"),setTimeout(function(){a.classList.add("mip-custom-transit-end")},0);if(m._fixedLayer)m.setFixedElement([a],!0),c(e,m._fixedLayer)}function n(t,e,i,n,o){var r=o.querySelector(i+"["+n+"]")||document.createElement(i);r.setAttribute(n,"");var a=t.match(e);a&&a.forEach(function(t){var e=new RegExp("<"+i+">([\\S\\s]*)</"+i+">","g"),n=e.exec(t),o=n&&n[1]?n[1]:"";if(-1===r.innerHTML.indexOf(o))r.innerHTML+=o}),o.appendChild(r)}function o(t,e){var i=document.createElement("template");if(i.setAttribute("type","mip-mustache"),e)i.id=e;return i.innerHTML=b.subStr(t,g.innerHtml),i}function r(t,e){for(var i=document.createElement(e),n=b.subStr(t,g.tagandAttr).split(" "),r=0;r<n.length;r++){var a=n[r].split("=");if(a[0]&&a[1])i.setAttribute(a[0],a[1].replace(/"/gi,""))}return i.appendChild(o(t)),i}function a(t,n,o,a,s){var c=n.replace(g.script,"").replace(g.style,""),l=new RegExp(g.tag,"g").exec(c);if(!(l=l&&l[1]?l[1]:null))return null;var p=r(c,l),d=document.createElement("div");if(d.setAttribute("mip-custom-item",o),p.itemNode=d,p.container=s,p.hasAttribute("mip-fixed"))i(t,p,s);return h.render(p,a,!0).then(function(n){if(n.element.innerHTML=n.html,n.element.itemNode.appendChild(n.element),n.element.container.appendChild(n.element.itemNode),n.element.hasAttribute("mip-fixed")&&"bottom"===n.element.getAttribute("mip-fixed")){i(t,p,s),m.setPlaceholder();var o=e(n.element.parentNode,"z-index");if(o>=y)y=o,m.setPlaceholder(e(n.element,"height")-x)}}),l}function s(t,e,i){for(var o=0;o<e.length;o++){var r=e[o].tplData;if(!(!r||r instanceof Array&&!r.length||r instanceof Object&&!Object.keys(r).length)){var s=e[o].tpl?decodeURIComponent(e[o].tpl):null;if(s){n(s,g.style,"style","mip-custom-css",document.head);var c=a(t,s,o,r,i);if(c)n(s,g.script,"script",c,document.body)}}}}function c(t,e){u.event.delegate(t,"a","click",function(i){if(!this.hasAttribute("mip-link")&&!/clk_info/.test(this.href)){var n=this.getAttribute("data-log-href"),o=null;if(e)o=f.getXPath(this,e),o.unshift(".mip-fixedlayer");else o=f.getXPath(this,t);var r=o?o.join("_"):"",a=n?n:this.href;if(a+=("&"===a[a.length-1]?"":"&")+"clk_info="+JSON.stringify({xpath:r}),n)f.sendLog(a,{});else this.href=a}})}function l(t){if(t)return t.querySelector('script[type="application/json"]')}function p(){var t=document.createElement("div");this.placeholder=t,t.classList.add("mip-custom-placeholder"),t.setAttribute("mip-custom-container",""),t.innerHTML='<span class="mip-custom-placeholder-title"></span><span class="mip-custom-placeholder-text text1"></span><span class="mip-custom-placeholder-text text2"></span><span class="mip-custom-placeholder-text text3"></span><span class="mip-custom-placeholder-space"></span><span class="mip-custom-placeholder-title"></span><span class="mip-custom-placeholder-text text1"></span><span class="mip-custom-placeholder-text text2"></span><span class="mip-custom-placeholder-text text3"></span>',this.element.appendChild(t)}function d(){var t=this;this.placeholder.classList.add("fadeout"),this.placeholder.addEventListener("transitionend",function(){t.placeholder.remove()},!1),this.placeholder.addEventListener("webkitTransitionend",function(){t.placeholder.remove()},!1)}var u=t("util"),h=t("templates"),m=t("fixed-element"),f=t("mip-custom/log"),b=t("mip-custom/data"),g=b.regexs,y=0,x=44;return{render:s,proxyLink:c,getConfigScriptElement:l,addPlaceholder:p,removePlaceholder:d}});